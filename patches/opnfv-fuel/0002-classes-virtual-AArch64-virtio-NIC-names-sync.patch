::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
: Copyright (c) 2017 Enea AB and others.
:
: All rights reserved. This program and the accompanying materials
: are made available under the terms of the Apache License, Version 2.0
: which accompanies this distribution, and is available at
: http://www.apache.org/licenses/LICENSE-2.0
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
From: Alexandru Avadanii <Alexandru.Avadanii@enea.com>
Date: Tue, 25 Jul 2017 02:53:16 +0200
Subject: [PATCH] classes: virtual: AArch64: virtio NIC names sync

grep -e "ens[[:digit:]]" -R . -l | \
  xargs sed -i \
    -e 's/ens3/enp1s0/g' \
    -e 's/ens4/enp2s0/g' \
    -e 's/ens5/enp3s0/g' \
    -e 's/ens6/enp4s0/g'

Since AArch64 will be using virtio-net-pci NIC model for guests,
predictable interface naming yields a slightly different scheme.

Update all configuration to reflect this.

NOTE: Above configuration is expected with libvirt 3.x, which puts
each NIC on a separate PCIe bus (which also imposes virtio modern
is used).

Signed-off-by: Alexandru Avadanii <Alexandru.Avadanii@enea.com>
---
 .../cluster/virtual-mcp-ocata-common/openstack_compute.yml        | 8 ++++----
 .../cluster/virtual-mcp-ocata-common/openstack_control.yml        | 4 ++--
 .../cluster/virtual-mcp-ocata-common/openstack_gateway.yml        | 8 ++++----
 .../classes/cluster/virtual-mcp-ocata-odl-router/infra/config.yml | 2 +-
 .../cluster/virtual-mcp-ocata-odl-router/opendaylight/control.yml | 2 +-
 .../classes/cluster/virtual-mcp-ocata-ovs-dpdk/infra/config.yml   | 6 +++---
 .../classes/cluster/virtual-mcp-ocata-ovs/infra/config.yml        | 2 +-
 7 files changed, 16 insertions(+), 16 deletions(-)

diff --git a/mcp/reclass/classes/cluster/virtual-mcp-ocata-common/openstack_compute.yml b/mcp/reclass/classes/cluster/virtual-mcp-ocata-common/openstack_compute.yml
index 0cb7ccb..808fbab 100644
--- a/mcp/reclass/classes/cluster/virtual-mcp-ocata-common/openstack_compute.yml
+++ b/mcp/reclass/classes/cluster/virtual-mcp-ocata-common/openstack_compute.yml
@@ -12,9 +12,9 @@ classes:
 - system.ceilometer.client.cinder_volume
 parameters:
   _param:
-    primary_interface: ens4
-    tenant_interface: ens5
-    external_interface: ens6
+    primary_interface: enp2s0
+    tenant_interface: enp3s0
+    external_interface: enp4s0
     interface_mtu: 9000
     linux_system_codename: xenial
     loopback_device_size: 10
@@ -50,7 +50,7 @@ parameters:
       interface:
         dhcp_int:
           enabled: true
-          name: ens3
+          name: enp1s0
           proto: dhcp
           type: eth
           mtu: ${_param:interface_mtu}
diff --git a/mcp/reclass/classes/cluster/virtual-mcp-ocata-common/openstack_control.yml b/mcp/reclass/classes/cluster/virtual-mcp-ocata-common/openstack_control.yml
index 0927900..69fedb6 100644
--- a/mcp/reclass/classes/cluster/virtual-mcp-ocata-common/openstack_control.yml
+++ b/mcp/reclass/classes/cluster/virtual-mcp-ocata-common/openstack_control.yml
@@ -48,13 +48,13 @@ parameters:
           version: latest
     network:
       interface:
-        ens4:
+        enp2s0:
           enabled: true
           type: eth
           proto: static
           address: ${_param:single_address}
           netmask: 255.255.255.0
-        ens6:
+        enp4s0:
           enabled: true
           type: eth
           proto: static
diff --git a/mcp/reclass/classes/cluster/virtual-mcp-ocata-common/openstack_gateway.yml b/mcp/reclass/classes/cluster/virtual-mcp-ocata-common/openstack_gateway.yml
index 9262590..f5479fc 100644
--- a/mcp/reclass/classes/cluster/virtual-mcp-ocata-common/openstack_gateway.yml
+++ b/mcp/reclass/classes/cluster/virtual-mcp-ocata-common/openstack_gateway.yml
@@ -4,9 +4,9 @@ classes:
 - system.linux.system.repo.saltstack.xenial
 parameters:
   _param:
-    primary_interface: ens4
-    tenant_interface: ens5
-    external_interface: ens6
+    primary_interface: enp2s0
+    tenant_interface: enp3s0
+    external_interface: enp4s0
     interface_mtu: 9000
     linux_system_codename: xenial
   neutron:
@@ -19,7 +19,7 @@ parameters:
       interface:
         dhcp_int:
           enabled: true
-          name: ens3
+          name: enp1s0
           proto: dhcp
           type: eth
           mtu: ${_param:interface_mtu}
diff --git a/mcp/reclass/classes/cluster/virtual-mcp-ocata-odl-router/infra/config.yml b/mcp/reclass/classes/cluster/virtual-mcp-ocata-odl-router/infra/config.yml
index 63e58a2..2f8e94a 100644
--- a/mcp/reclass/classes/cluster/virtual-mcp-ocata-odl-router/infra/config.yml
+++ b/mcp/reclass/classes/cluster/virtual-mcp-ocata-odl-router/infra/config.yml
@@ -27,7 +27,7 @@ parameters:
   linux:
     network:
       interface:
-        ens4:
+        enp2s0:
           enabled: true
           type: eth
           proto: static
diff --git a/mcp/reclass/classes/cluster/virtual-mcp-ocata-odl-router/opendaylight/control.yml b/mcp/reclass/classes/cluster/virtual-mcp-ocata-odl-router/opendaylight/control.yml
index 6bc0f51..4dacc73 100644
--- a/mcp/reclass/classes/cluster/virtual-mcp-ocata-odl-router/opendaylight/control.yml
+++ b/mcp/reclass/classes/cluster/virtual-mcp-ocata-odl-router/opendaylight/control.yml
@@ -10,7 +10,7 @@ parameters:
   linux:
     network:
       interface:
-        ens4:
+        enp2s0:
           enabled: true
           type: eth
           proto: static
diff --git a/mcp/reclass/classes/cluster/virtual-mcp-ocata-ovs-dpdk/infra/config.yml b/mcp/reclass/classes/cluster/virtual-mcp-ocata-ovs-dpdk/infra/config.yml
index 864c71d..aec6cde 100644
--- a/mcp/reclass/classes/cluster/virtual-mcp-ocata-ovs-dpdk/infra/config.yml
+++ b/mcp/reclass/classes/cluster/virtual-mcp-ocata-ovs-dpdk/infra/config.yml
@@ -26,7 +26,7 @@ parameters:
   linux:
     network:
       interface:
-        ens4:
+        enp2s0:
           enabled: true
           type: eth
           proto: static
@@ -51,14 +51,14 @@ parameters:
             single_address: 172.16.10.105
             tenant_address: 10.1.0.105
             external_address: 10.16.0.105
-            dpdk0_name: ens5
+            dpdk0_name: enp3s0
             dpdk0_pci: '"0000:00:05.0"'
         openstack_compute_node02:
           params:
             single_address: 172.16.10.106
             tenant_address: 10.1.0.106
             external_address: 10.16.0.106
-            dpdk0_name: ens5
+            dpdk0_name: enp3s0
             dpdk0_pci: '"0000:00:05.0"'
         openstack_gateway_node01:
           params:
diff --git a/mcp/reclass/classes/cluster/virtual-mcp-ocata-ovs/infra/config.yml b/mcp/reclass/classes/cluster/virtual-mcp-ocata-ovs/infra/config.yml
index 97730b1..8cb0992 100644
--- a/mcp/reclass/classes/cluster/virtual-mcp-ocata-ovs/infra/config.yml
+++ b/mcp/reclass/classes/cluster/virtual-mcp-ocata-ovs/infra/config.yml
@@ -26,7 +26,7 @@ parameters:
   linux:
     network:
       interface:
-        ens4:
+        enp2s0:
           enabled: true
           type: eth
           proto: static
