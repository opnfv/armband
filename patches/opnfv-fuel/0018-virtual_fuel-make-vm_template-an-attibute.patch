From: Josep Puigdemont <josep.puigdemont@enea.com>
Date: Wed, 4 May 2016 14:27:23 +0200
Subject: [PATCH] virtual_fuel: make vm_template an attibute

Signed-off-by: Josep Puigdemont <josep.puigdemont@enea.com>
---
 deploy/environments/virtual_fuel.py | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/deploy/environments/virtual_fuel.py b/deploy/environments/virtual_fuel.py
index 4d630ec..34e63ed 100644
--- a/deploy/environments/virtual_fuel.py
+++ b/deploy/environments/virtual_fuel.py
@@ -47,6 +47,10 @@ class VirtualFuel(ExecutionEnvironment):
         self.temp_dir = tempfile.mkdtemp()
         self.vm_name = self.dha.get_node_property(self.fuel_node_id,
                                                   'libvirtName')
+        self.vm_template = '%s/%s' % (self.root_dir,
+                                      self.dha.get_node_property(
+                                          self.fuel_node_id, 'libvirtTemplate'))
+        check_file_exists(self.vm_template)
 
     def __del__(self):
         delete(self.temp_dir)
@@ -108,7 +112,7 @@ class VirtualFuel(ExecutionEnvironment):
         disk_path = self.create_image(disk_path, disk_size)
 
         temp_vm_file = '%s/%s' % (self.temp_dir, self.vm_name)
-        exec_cmd('cp %s %s' % (vm_template, temp_vm_file))
+        exec_cmd('cp %s %s' % (self.vm_template, temp_vm_file))
         self.set_vm_nic(temp_vm_file)
         vm_definition_overwrite = self.dha.get_vm_definition('fuel')
         self.define_vm(self.vm_name, temp_vm_file, disk_path,
