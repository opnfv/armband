From: Charalampos Kominos <Charalampos.kominos@enea.com>
Date: Tue, 22 Aug 2017 19:33:56 +0200
Subject: [PATCH] Add opnfv user to all machines

Signed-off-by: Charalampos Kominos <Charalampos.Kominos@enea.com>
---
 mcp/config/states/maas                | 2 ++
 mcp/salt-formulas/armband/adduser.sls | 8 ++++++++
 2 files changed, 10 insertions(+)
 create mode 100644 mcp/salt-formulas/armband/adduser.sls

diff --git a/mcp/config/states/maas b/mcp/config/states/maas
index 3cea11d..94dcdba 100755
--- a/mcp/config/states/maas
+++ b/mcp/config/states/maas
@@ -59,6 +59,7 @@ salt -C '* and not cfg01* and not mas01*' state.apply salt
 salt -C 'kvm*' saltutil.sync_all
 salt -C 'kvm*' state.sls salt.control
+
 vcp_nodes=$(salt --out yaml 'kvm01*' pillar.get salt:control:cluster:internal:node | awk '/\s+\w+:$/ {gsub(/:$/, "*"); print $1}')

 # Check all vcp nodes are available
@@ -71,6 +72,7 @@ while [ $rc -ne 0 ]; do
   sleep 5
 done
+salt -C '*' state.apply armband.adduser
 salt -C '* and not cfg01* and not mas01*' saltutil.sync_all
 salt -C '* and not cfg01* and not mas01*' state.apply salt
 wait_for "salt -C '* and not cfg01* and not mas01*' state.apply linux,ntp"
diff --git a/mcp/salt-formulas/armband/adduser.sls b/mcp/salt-formulas/armband/adduser.sls
new file mode 100644
index 0000000..b5bba78
--- /dev/null
+++ b/mcp/salt-formulas/armband/adduser.sls
@@ -0,0 +1,8 @@
+add_pharos_user:
+  user.present:
+  - name: opnfv
+  - password: $1$5/pIEHT1$XFBhNWW4Q8gYd19hczgPF1
+  - createhome: True
+  - groups:
+    - sudo
+
