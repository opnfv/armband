From: Alexandru Avadanii <Alexandru.Avadanii@enea.com>
Date: Thu, 19 May 2016 16:52:18 +0200
Subject: Build odl plugin for mitaka

Change-Id: I59b96a424a753f880b4ac16abd806851ad3f9533
Signed-off-by: Michal Skalski <mskalski@mirantis.com>
---
 build/f_isoroot/Makefile                   |  2 +-
 build/f_isoroot/f_odlpluginbuild/Makefile  |  9 ++++++++-
 build/f_isoroot/f_odlpluginbuild/config.mk | 14 +++++++++-----
 3 files changed, 18 insertions(+), 7 deletions(-)

diff --git a/build/f_isoroot/Makefile b/build/f_isoroot/Makefile
index 20d2fb0..17ebef3 100644
--- a/build/f_isoroot/Makefile
+++ b/build/f_isoroot/Makefile
@@ -11,7 +11,7 @@
 # Add Fuel plugin build targets here
 # Plugins disabled for the Fuel Mitaka uplift. Please re-enable your plugin as you have
 # verified it!
-PLUGINS =
+PLUGINS = f_odlpluginbuild
 #PLUGINS = f_odlpluginbuild f_onosfwpluginbuild f_ovsnfv-dpdk-pluginbuild f_vsperfpluginbuild f_qemupluginbuild f_ovs-nsh-dpdk-pluginbuild f_bgpvpn-pluginbuild
 export PLUGINS
 #NON_8-0_REBASED_PLUGINS = f_bgpvpn-pluginbuild
diff --git a/build/f_isoroot/f_odlpluginbuild/Makefile b/build/f_isoroot/f_odlpluginbuild/Makefile
index 9cb8fef..efea0f5 100644
--- a/build/f_isoroot/f_odlpluginbuild/Makefile
+++ b/build/f_isoroot/f_odlpluginbuild/Makefile
@@ -29,7 +29,14 @@ release:.odlbuild
 	rm -rf fuel-plugin-opendaylight
 	sudo apt-get -y install build-essential ruby-dev rubygems-integration python-pip git rpm createrepo dpkg-dev
 	sudo gem install fpm
-	sudo pip install fuel-plugin-builder
+	#Temporary fpb needs to be build from sources
+	git clone -b $(FPB_BRANCH) $(FPB_REPO)
+	cd fuel-plugins; \
+	if [ -n $(FPB_CHANGE) ]; then \
+	   git checkout $(FPB_CHANGE); \
+		 python setup.py sdist; \
+		 sudo pip install ./dist/fuel-plugin-builder-*.tar.gz; \
+	fi
 	git clone -b $(ODL_BRANCH) $(ODL_REPO)
 	cd fuel-plugin-opendaylight; \
 	if [ -n $(ODL_CHANGE) ]; then \
diff --git a/build/f_isoroot/f_odlpluginbuild/config.mk b/build/f_isoroot/f_odlpluginbuild/config.mk
index a5e8a96..c613af7 100644
--- a/build/f_isoroot/f_odlpluginbuild/config.mk
+++ b/build/f_isoroot/f_odlpluginbuild/config.mk
@@ -7,11 +7,15 @@
 # http://www.apache.org/licenses/LICENSE-2.0
 ##############################################################################
 
-ODL_BRANCH=brahmaputra-sr2
-ODL_CHANGE=ec9474c1178e7451ec75f6e306ac84424a84a28a
-ODL_REPO="https://github.com/openstack/fuel-plugin-opendaylight.git"
+ODL_BRANCH ?= master
+ODL_CHANGE ?= 1c8443ffc64af120337740551307378d1c21535d
+ODL_REPO ?= https://github.com/openstack/fuel-plugin-opendaylight.git
+
+FPB_BRANCH ?= master
+FPB_CHANGE ?= 82191ca16b40021e445e854fad37c65cd8e70b0c
+FPB_REPO ?= https://github.com/openstack/fuel-plugins
 
 export USE_JAVA8?=true
 export JAVA8_URL?=https://launchpad.net/~openjdk-r/+archive/ubuntu/ppa/+files/openjdk-8-jre-headless_8u72-b15-1~trusty1_amd64.deb
-export ODL_TARBALL_LOCATION?=https://nexus.opendaylight.org/content/repositories/opendaylight.release/org/opendaylight/integration/distribution-karaf/0.4.1-Beryllium-SR1/distribution-karaf-0.4.1-Beryllium-SR1.tar.gz
-export ODL_VERSION_NUMBER?=0.4.1
+export ODL_TARBALL_LOCATION?=https://nexus.opendaylight.org/content/groups/public/org/opendaylight/integration/distribution-karaf/0.4.2-Beryllium-SR2/distribution-karaf-0.4.2-Beryllium-SR2.tar.gz
+export ODL_VERSION_NUMBER?=0.4.2
