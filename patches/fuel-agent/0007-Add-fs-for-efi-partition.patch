From: Stanislaw Kardach <stanislaw.kardach@caviumnetworks.com>
Date: Tue, 8 Mar 2016 21:08:55 +0100
Subject: [PATCH] Add fs for efi partition

---
 debian/control                | 1 +
 fuel_agent/drivers/nailgun.py | 4 +++-
 specs/fuel-agent.spec         | 1 +
 3 files changed, 5 insertions(+), 1 deletion(-)

diff --git a/debian/control b/debian/control
index 189dc00..acfda35 100644
--- a/debian/control
+++ b/debian/control
@@ -39,6 +39,7 @@ Depends: bzip2,
 	 qemu-user-static,
 	 binfmt-support,
 	 dmidecode,
+	 dosfstools,
 	 ethtool,
 	 gdisk,
 	 genisoimage,
diff --git a/fuel_agent/drivers/nailgun.py b/fuel_agent/drivers/nailgun.py
index bc532b4..31aead6 100644
--- a/fuel_agent/drivers/nailgun.py
+++ b/fuel_agent/drivers/nailgun.py
@@ -324,7 +324,9 @@ class Nailgun(BaseDataDriver):
                 # uefi partition (for future use)
                 LOG.debug('Adding UEFI partition on disk %s: size=200' %
                           disk['name'])
-                parted.add_partition(size=200, flags=['esp'])
+                prt = parted.add_partition(size=200, flags=['esp'])
+                partition_scheme.add_fs(device=prt.name, mount='/boot/efi',
+                    fs_type='vfat', fs_label='efs_boot')
 
             LOG.debug('Looping over all volumes on disk %s' % disk['name'])
             for volume in disk['volumes']:
diff --git a/specs/fuel-agent.spec b/specs/fuel-agent.spec
index a43f693..c2b9b51 100644
--- a/specs/fuel-agent.spec
+++ b/specs/fuel-agent.spec
@@ -50,6 +50,7 @@ Requires:    xfsprogs
 Requires:    pciutils
 Requires:    ethtool
 Requires:    debootstrap
+Requires:    dosfstools
 Requires:    dpkg
 Requires:    qemu-user-static
 Requires:    xz
-- 
1.9.1

