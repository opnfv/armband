From: Stanislaw Kardach <stanislaw.kardach@caviumnetworks.com>
Date: Tue, 15 Mar 2016 11:33:52 +0100
Subject: [PATCH] Disable usb tablet for aarch64

---
 deployment/puppet/openstack_tasks/manifests/roles/compute.pp | 12 ++++++++++++
 1 file changed, 12 insertions(+)

diff --git a/deployment/puppet/openstack_tasks/manifests/roles/compute.pp b/deployment/puppet/openstack_tasks/manifests/roles/compute.pp
index 7568a86..5d12be8 100644
--- a/deployment/puppet/openstack_tasks/manifests/roles/compute.pp
+++ b/deployment/puppet/openstack_tasks/manifests/roles/compute.pp
@@ -383,6 +383,10 @@ class openstack_tasks::roles::compute {
   }
 
   nova_config {
+    'libvirt/use_usb_tablet': value => $::architecture ? {
+        /(arm64|aarch64)/ => false,
+        default           => true,
+    }
     'libvirt/live_migration_flag':  value => 'VIR_MIGRATE_UNDEFINE_SOURCE,VIR_MIGRATE_PEER2PEER,VIR_MIGRATE_LIVE,VIR_MIGRATE_PERSIST_DEST';
     'libvirt/block_migration_flag': value => 'VIR_MIGRATE_UNDEFINE_SOURCE,VIR_MIGRATE_PEER2PEER,VIR_MIGRATE_LIVE,VIR_MIGRATE_NON_SHARED_INC';
     'DEFAULT/connection_type':      value => 'libvirt';
@@ -409,6 +413,14 @@ class openstack_tasks::roles::compute {
     vncserver_listen                           => '0.0.0.0',
     remove_unused_original_minimum_age_seconds => pick($nova_hash_real['remove_unused_original_minimum_age_seconds'], '86400'),
     libvirt_service_name                       => $::nova::params::libvirt_service_name,
+  } ->
+  package { 'vgabios':
+    ensure => present;
+  } ->
+  file { '/usr/share/qemu/vgabios-stdvga.bin':
+    ensure  => link,
+    target  => '/usr/share/vgabios/vgabios.bin',
+    replace => false,
   }
 
   class { '::nova::migration::libvirt':
