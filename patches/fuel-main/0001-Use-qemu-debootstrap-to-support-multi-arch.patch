From: Stanislaw Kardach <stanislaw.kardach@caviumnetworks.com>
Date: Thu, 25 Feb 2016 13:31:19 +0100
Subject: [PATCH] Use qemu-debootstrap to support multi-arch

---
 prepare-build-env.sh | 1 +
 requirements-rpm.txt | 1 +
 sandbox.mk           | 4 ++--
 3 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/prepare-build-env.sh b/prepare-build-env.sh
index 9b099c6..94b456b 100755
--- a/prepare-build-env.sh
+++ b/prepare-build-env.sh
@@ -39,6 +39,7 @@ sudo apt-get -y install \
   lrzip \
   python-jinja2 \
   python-yaml \
+  qemu-user-static
   reprepro \
   rpm \
   syslinux \
diff --git a/requirements-rpm.txt b/requirements-rpm.txt
index e316ee4..498a1c6 100644
--- a/requirements-rpm.txt
+++ b/requirements-rpm.txt
@@ -202,6 +202,7 @@ python-yaql
 pytz
 PyYAML
 qemu-img
+qemu-user-static
 rabbitmq-server
 rpm
 rpm-build
diff --git a/sandbox.mk b/sandbox.mk
index 4bc3962..863484e 100644
--- a/sandbox.mk
+++ b/sandbox.mk
@@ -187,8 +187,8 @@ mkdir -p $(SANDBOX_UBUNTU)/etc/init.d
 touch $(SANDBOX_UBUNTU)/etc/init.d/.legacy-bootordering
 mkdir -p $(SANDBOX_UBUNTU)/usr/sbin
 cp -a $(BUILD_DIR)/policy-rc.d $(SANDBOX_UBUNTU)/usr/sbin
-echo "Running debootstrap"
-sudo debootstrap --no-check-gpg --include=ca-certificates --arch=$(UBUNTU_ARCH) $(MIRROR_UBUNTU_SUITE) $(SANDBOX_UBUNTU) $(MIRROR_UBUNTU_METHOD)://$(MIRROR_UBUNTU)$(MIRROR_UBUNTU_ROOT)
+echo "Running qemu-debootstrap"
+sudo qemu-debootstrap --no-check-gpg --include=ca-certificates --arch=$(UBUNTU_ARCH) $(MIRROR_UBUNTU_SUITE) $(SANDBOX_UBUNTU) $(MIRROR_UBUNTU_METHOD)://$(MIRROR_UBUNTU)$(MIRROR_UBUNTU_ROOT)
 if [ -e $(SANDBOX_UBUNTU)/etc/resolv.conf ]; then sudo cp -a $(SANDBOX_UBUNTU)/etc/resolv.conf $(SANDBOX_UBUNTU)/etc/resolv.conf.orig; fi
 sudo cp /etc/resolv.conf $(SANDBOX_UBUNTU)/etc/resolv.conf
 if [ -e $(SANDBOX_UBUNTU)/etc/hosts ]; then sudo cp -a $(SANDBOX_UBUNTU)/etc/hosts $(SANDBOX_UBUNTU)/etc/hosts.orig; fi
